<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar cuenta - Decode</title>
    <link rel="stylesheet" href="assets/styles/style-login.css">
    <link rel="stylesheet" href="assets/styles/styles.css">
</head>
<body>
    <header class="header">
        <section class="header__logo">
            <img src="assets/icons/logo.png" alt="" srcset="">
            <div class="header__title">
                <h2 class="header__title-main">Decode</h2>
                <p class="header__title-sub">SmartSolutions</p>
            </div>
        </section>

        <section class="header__interaction">
            <nav class="header__nav">
                <a href="index.html" class="header__nav-link">Inicio</a>
                <a href="#" class="header__nav-link">Comunidad</a>
                <a href="#" class="header__nav-link">Sobre nosotros</a>
                <a href="#" class="header__nav-link">Suscripciones</a>
            </nav>
        </section>
    </header>

    <section class="sesion">
        <div class="login">
            <div class="login__info" style="text-align: center;">
                <img src="assets/icons/mail.svg" alt="Correo">
                <h2>Restablecer contraseña</h2>
            </div>

            <form class="recover-form">
                <div id="step1">
                    <div class="login__input">
                        <p style="text-align: center;">Ingrese su correo para enviar un código de verificación</p>
                        <input type="email" id="rec__email" name="email" required>
                        <p id="rec__email-error" style="color:rgb(202, 17, 17); display:none;">
                            No existe una cuenta con ese correo.
                        </p>
                    </div>

                    <div class="login__enter">
                        <button type="button" class="btn" id="btn__ingresar-correo">Ingresar correo</button>
                        <p><a href="login.html">Volver a iniciar sesión</a></p>
                    </div>
                </div>

                <div id="step2" style="display:none;">
                    <div class="login__input">
                        <p>Ingresa tu código de verificación</p>
                        <input type="text" id="rec__codigo" name="codigo" required>
                        <p id="rec__codigo-error" style="color:rgb(202, 17, 17); display:none;">
                            Código incorrecto. El código de prueba es 123.
                        </p>
                    </div>

                    <div class="login__enter">
                        <button type="button" class="btn" id="btn__verificar-codigo">Verificar código</button>
                    </div>
                </div>

                <div id="step3" style="display:none;">
                    <div class="login__input">
                        <p>Ingrese su nueva contraseña</p>
                        <input type="password" id="rec__pass1" name="nueva_pass" required>
                    </div>

                    <div class="login__input">
                        <p>Confirmar nueva contraseña</p>
                        <input type="password" id="rec__pass2" name="confirmar_pass" required>
                        <p id="rec__pass-error" style="color:rgb(202, 17, 17); display:none;">
                            Las contraseñas no coinciden o están vacías.
                        </p>
                    </div>

                    <div class="login__enter">
                        <button type="button" class="btn" id="btn__actualizar-pass">Actualizar contraseña</button>
                    </div>
                </div>

                <div id="step4" style="display:none;">
                    <p style="margin-top: 1.5rem; text-align:center;">
                        Tu contraseña ha sido actualizada correctamente.
                    </p>
                    <div class="login__enter">
                        <a href="login.html" class="btn" style="
                            text-align:center;
                            display:block;
                            padding-top:10px;
                            text-decoration:none;
                        ">
                            Ir a iniciar sesión
                        </a>
                    </div>
                </div>

            </form>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
        function crearUsuarioDePrueba() {
            const usuarios = JSON.parse(localStorage.getItem("usuarios"));
            if (!usuarios || usuarios.length === 0) {
                const usuarioPrueba = [{
                    email: "prueba@decode.com",
                    contraseña: "oldpassword",
                    nombre: "Usuario Prueba"
                }];
                localStorage.setItem("usuarios", JSON.stringify(usuarioPrueba));
                console.log("Se ha inicializado un usuario de prueba: prueba@decode.com");
            }
        }
        crearUsuarioDePrueba(); 

        const step1 = document.getElementById("step1");
        const step2 = document.getElementById("step2");
        const step3 = document.getElementById("step3");
        const step4 = document.getElementById("step4");

        const emailInput = document.getElementById("rec__email");
        const emailError = document.getElementById("rec__email-error");

        const codigoInput = document.getElementById("rec__codigo");
        const codigoError = document.getElementById("rec__codigo-error");

        const pass1Input = document.getElementById("rec__pass1");
        const pass2Input = document.getElementById("rec__pass2");
        const passError = document.getElementById("rec__pass-error");

        const btnIngresarCorreo = document.getElementById("btn__ingresar-correo"); 
        const btnVerificarCodigo = document.getElementById("btn__verificar-codigo");
        const btnActualizarPass = document.getElementById("btn__actualizar-pass");

        let emailRecuperacion = null;

        btnIngresarCorreo.addEventListener("click", function() {
            if (!emailInput.reportValidity()) return;

            const email = emailInput.value.trim();
            const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
            const existe = usuarios.some(u => u.email === email);
            
            if (!existe) {
                emailError.style.display = "block";
                return;
            }

            emailError.style.display = "none";
            emailRecuperacion = email;
            step1.style.display = "none";
            step2.style.display = "block";
            codigoInput.focus();
        });
        
        btnVerificarCodigo.addEventListener("click", () => {
            if (!codigoInput.reportValidity()) return;

            const codigo = codigoInput.value.trim();

            if (codigo === "123") {
                codigoError.style.display = "none";
                step2.style.display = "none";
                step3.style.display = "block";
                pass1Input.focus();
            } else {
                codigoError.style.display = "block";
            }
        });

        btnActualizarPass.addEventListener("click", () => {
            if (!pass1Input.reportValidity() || !pass2Input.reportValidity()) return;
            
            const pass1 = pass1Input.value;
            const pass2 = pass2Input.value;

            if (pass1 === "" || pass2 === "" || pass1 !== pass2) {
                passError.style.display = "block";
                return;
            }

            passError.style.display = "none";
            const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
            const indice = usuarios.findIndex(u => u.email === emailRecuperacion);

            if (indice !== -1) {
                usuarios[indice].contraseña = pass1;
                localStorage.setItem("usuarios", JSON.stringify(usuarios));
            }

            step3.style.display = "none";
            step4.style.display = "block";
        });
        
        // FUNCIONALIDAD DE TECLA ENTER
        
        emailInput.addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                btnIngresarCorreo.click();
            }
        });

        codigoInput.addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                btnVerificarCodigo.click();
            }
        });

        pass1Input.addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                pass2Input.focus();
            }
        });
        
        pass2Input.addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                btnActualizarPass.click();
            }
        });
    });
    </script>
</body>
</html>